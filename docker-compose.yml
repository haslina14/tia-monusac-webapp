services:
  app:
    build: .
    restart: unless-stopped
    container_name: tia
    init: true
    stop_signal: SIGINT #flask require sigint to stop gracefully
    ports:
      - "5000:5000"
    volumes:
      - ./uploads:/app/uploads #to mount
    environment:
      - PYTHONPATH=/app
      - CONDA_DEFAULT_ENV=tia-gui
    deploy:
      resources:
        reservations:
          devices:
          - driver: nvidia
            count: all #how many gpus can be connected
            capabilities: [gpu]
    command: conda run -n tia-gui python app.py